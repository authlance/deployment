# Duna Docker Compose Environment

# Project
COMPOSE_PROJECT_NAME=duna
DOCKER_DEFAULT_NETWORK=duna-net
TZ=UTC

# Images
MYSQL_IMAGE=mysql:8.0
KRATOS_IMAGE=oryd/kratos:latest
HYDRA_IMAGE=oryd/hydra:latest
AUTH_IMAGE=ghcr.io/authlance/authlance-auth:1.0.0
LICENSE_IMAGE=ghcr.io/authlance/authlance-license-operator:1.0.0
JWT_SECRET=SUPER-SECRET-JWT-KEY

# Core services & ports
MYSQL_HOST=mysql
MYSQL_PORT=3306
MYSQL_LOCAL_PORT=3307
MYSQL_ROOT_PASSWORD=secret1234
KRATOS_PUBLIC_PORT=4433
KRATOS_ADMIN_PORT=4434
HYDRA_PUBLIC_PORT=4444
HYDRA_ADMIN_PORT=4445
NATS_LOCAL_PORT=4222
NATS_HTTP_PORT=8222
NGINX_LOCAL_PORT=8080
NGINX_HTTPS_PORT=8443

# Databases
AUTH_DB_NAME=authlance-auth
AUTH_DB_USER=duna
AUTH_DB_PASSWORD=secret1234
LICENSE_DB_NAME=authlance-licenses
LICENSE_DB_USER=duna
LICENSE_DB_PASSWORD=secret1234
LOOP_DB_NAME=duna-loop
LOOP_DB_USER=duna
LOOP_DB_PASSWORD=secret1234
KRATOS_DB_NAME=kratos
KRATOS_DB_USER=kratos
KRATOS_DB_PASSWORD=secret1234
HYDRA_DB_NAME=hydra
HYDRA_DB_USER=hydra
HYDRA_DB_PASSWORD=secret1234

# ORY URLs & secrets
FRONTEND_BASE_URL=https://local.example.com
KRATOS_PUBLIC_BASE_URL=http://kratos:4433/
OAUTH2_PROVIDER_AUTH_HEADER="Bearer hydra-dev-token"
REGISTRATION_WEBHOOK_URL=http://authlance:8001/authlance/identity/email/register
REGISTRATION_WEBHOOK_AUTH_HEADER="Basic ZHVuYToxMjM0" # base64(duna:1234) check MAIL_USER and MAIL_PASSWORD below
COURIER_HTTP_URL=http://authlance:8001/authlance/identity/email
COURIER_HTTP_BASIC_USER=duna
COURIER_HTTP_BASIC_PASSWORD=1234
KRATOS_COOKIE_SECRET=s3cr3t-cookie-key-1234567890
KRATOS_CIPHER_SECRET=s3cr3t-cipher-key-1234567890abcd
HYDRA_SYSTEM_SECRET=s3cr3t-hydra-system-key
HYDRA_ISSUER_URL=https://local.exemple.com/
IDENTITY_SCHEMA_ID_URL=https://schemas.example.com/authlance/identity.schema.json
IDENTITY_SCHEMA_TITLE=Person
MAIL_SENDER_EMAIL=nacho@example.com

# Auth service
AUTH_PORT=8000
KRATOS_PUBLIC_URL=http://kratos:4433/
KRATOS_ADMIN_URL=http://kratos:4434/
HYDRA_PUBLIC_URL=http://hydra:4444/
HYDRA_ADMIN_URL=http://hydra:4445/
HYDRA_LOGIN_TOKEN=authlance-hydra-login-token
NATS_URL=nats://nats:4222
AUTH_JWT_KEY=${JWT_SECRET}
COOKIE_DOMAIN=.example.com
AUTH_AUTO_CREATE_GROUP=true
AUTH_ADMIN_EMAIL=user@example.com
AUTH_ADMIN_FIRST_NAME=User
AUTH_ADMIN_LAST_NAME=Example
AUTH_ADMIN_GROUP=sysadmin
AUTH_ADMIN_IS_ADMIN=true
AUTH_REQUIRE_GENDER_EXTRA=false
AUTH_REQUIRE_BIRTHDATE_EXTRA=false
AUTH_EVENTS_DISABLE_USER_AUTHENTICATED=true
AUTH_EVENTS_DISABLE_SUBSCRIPTION_EVENTS=true
AUTH_BACKUP_DB1=authlance-auth
AUTH_BACKUP_DB2=kratos
AUTH_BACKUP_DB3=hydra
AUTH_DEBUG=true
MAIL_PORT=8001
MAIL_USER=duna
MAIL_PASSWORD=1234
S3_KEY=XXXXXXXXXXXXXXXX
S3_SECRET=XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
S3_REGION=us-east-1
S3_ENDPOINT=https://nyc3.digitaloceanspaces.com
S3_BUCKET=example
S3_SECONDARY_BUCKET=example-snapshots # mysqldump backups bucket
S3_CDN_URL=https://images.example.com
STRIPE_SECRET_KEY=XXXXXXXXXXXXXXXX   # Auth service Stripe secret key 
STRIPE_WEBHOOK_SECRET=whsec_XXXXXXXXXXXXXXXX # Auth service Stripe webhook secret
STRIPE_WEBHOOK_BASE_URL=https://local.example.com
STRIPE_SUCCESS_BASE_URL=https://local.example.com
STRIPE_ROOT_APP_URL=https://local.example.com
STRIPE_FRONTEND_BASE_PATH=/
STRIPE_TRIAL_PERIOD_DAYS=30
STRIPE_PORTAL_RETURN_URL=https://local.example.com/settings/billing
LICENSE_PATH=/app/config/authlance.lic
LICENSE_REFRESH_INTERVAL=30m
LICENSE_GRACE_PERIOD_DAYS=45
AUTH_LICENSE_FILE=./licenses/authlance.lic

# License operator
LO_SERVER_ADDR=:8083
LO_PUBLIC_BASE_URL=https://local.example.com
LO_PRIVATE_KEY_PEM="      -----BEGIN RSA PRIVATE KEY-----
      MIIEXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
      -----END RSA PRIVATE KEY-----"
LO_PUBLIC_KEY_PEM="      -----BEGIN PUBLIC KEY-----
      MIIBIXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
      -----END PUBLIC KEY-----"
LO_JWT_SECRET=${JWT_SECRET}
LO_ISSUER=example-issuer
LO_AUDIENCE=example-audience
LO_TOKEN_TTL=120m
LO_STRIPE_API_KEY=sk_live_XXXXXXXX
LO_STRIPE_WEBHOOK_SECRET=whsec_XXXXXXXX
LO_STRIPE_ENSURE_WEBHOOK=true
LO_STRIPE_REQUIRE_GROUP_NAME=true
LO_STRIPE_ROOT_APP_URL=https://local.example.com
LO_STRIPE_SUCCESS_BASE_URL=https://local.example.com
LO_STRIPE_PORTAL_RETURN_URL=https://local.example.com
LO_STRIPE_TRIAL_PERIOD_DAYS=30
LO_STRIPE_SYNC_PRODUCTS_ON_STARTUP=true
LO_STRIPE_ENABLE_AUTOMATIC_TAXES=true
LO_STRIPE_DEFAULT_SUBSCRIPTION_SLUG=example-subscription
LO_STRIPE_DEFAULT_ONE_OFF_SLUG=example-one-off
LO_FRONTEND_BASE_PATH=dashboard
LO_LICENSE_FILE_PATH=/app/config/trialLicense
LO_LICENSE_EXPECTED_DOMAIN=.example.com
LO_LICENSE_GRACE_DAYS=45
LO_LICENSE_REFRESH_INTERVAL=30m

# Loop scaffold config (runs outside Docker)
CORS_ORIGIN=${FRONTEND_BASE_URL}
POSTMARK_SERVER=pserver
POSTMARK_KEY=XXXXXXXX
POSTMARK_COMPANY=Duna
POSTMARK_FROM_EMAIL=user@example.com
POSTMARK_FROM_NAME=Jhon Doe
POSTMARK_FROM_POSITION=user
LOOP_JWT_SECRET=${JWT_SECRET}
LOOP_BASE_PATH=/authlance/loop
LOOP_FRONTEND_BASE_PATH=/
